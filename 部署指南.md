# ğŸš€ K8s ç™»å½•ç³»ç»Ÿ - å®Œæ•´éƒ¨ç½²æŒ‡å—

> ä¸€ä¸ªåŸºäº Kubernetes çš„å‰åç«¯åˆ†ç¦»ç™»å½•ç³»ç»Ÿ  
> å‰ç«¯ï¼šVue3 + Vite + Nginx | åç«¯ï¼šDjango + DRF | æ•°æ®åº“ï¼šPostgreSQL

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
2. [å¿«é€Ÿå¼€å§‹ï¼ˆ5åˆ†é’Ÿï¼‰](#å¿«é€Ÿå¼€å§‹)
3. [è¯¦ç»†éƒ¨ç½²æ­¥éª¤](#è¯¦ç»†éƒ¨ç½²æ­¥éª¤)
4. [è®¿é—®é…ç½®](#è®¿é—®é…ç½®)
5. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
6. [ç®¡ç†ç»´æŠ¤](#ç®¡ç†ç»´æŠ¤)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·æµè§ˆå™¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Kubernetes é›†ç¾¤ (Minikube)            â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend    â”‚â”€â”€â”€â†’â”‚  Backend     â”‚  â”‚
â”‚  â”‚  Vue3+Nginx  â”‚    â”‚  Django+DRF  â”‚  â”‚
â”‚  â”‚  (2 pods)    â”‚    â”‚  (3 pods)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚          â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                      â”‚  PostgreSQL   â”‚  â”‚
â”‚                      â”‚  (1 pod+PV)   â”‚  â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç‰¹æ€§

- âœ… å‰åç«¯åˆ†ç¦»ï¼Œç‹¬ç«‹æ‰©å±•
- âœ… é«˜å¯ç”¨éƒ¨ç½²ï¼ˆå¤šå‰¯æœ¬ï¼‰
- âœ… æ•°æ®æŒä¹…åŒ–ï¼ˆPostgreSQL PVï¼‰
- âœ… JWT Token è®¤è¯
- âœ… è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œæ¢å¤
- âœ… åŸŸåè®¿é—®æ”¯æŒ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

ç¡®ä¿å·²å®‰è£…ï¼š
- âœ… Docker >= 20.10
- âœ… Kubernetes (Minikube)
- âœ… kubectl >= 1.19

### ä¸€é”®éƒ¨ç½²

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/learn/01-k8s

# 2. é…ç½® Docker ç¯å¢ƒï¼ˆä½¿ç”¨ Minikube çš„ Dockerï¼‰
eval $(minikube docker-env)

# 3. æ„å»ºé•œåƒï¼ˆçº¦2-3åˆ†é’Ÿï¼‰
docker build -t login-backend:latest ./backend
docker build -t login-frontend:latest ./frontend

# 4. åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨ç›®å½•
minikube ssh "sudo mkdir -p /mnt/data/postgres && sudo chmod 777 /mnt/data/postgres"

# 5. ä¸€é”®éƒ¨ç½²ï¼ˆçº¦1-2åˆ†é’Ÿï¼‰
./scripts/deploy.sh

# 6. ç­‰å¾…éƒ¨ç½²å®Œæˆ
kubectl get pods -n login-system -w
```

**å®Œæˆï¼** ğŸ‰ ç­‰å¾…æ‰€æœ‰ Pod çŠ¶æ€å˜ä¸º `Running` å³å¯è®¿é—®ã€‚

---

## ğŸ“ è¯¦ç»†éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1ï¼šå‡†å¤‡ Kubernetes ç¯å¢ƒ

#### æ£€æŸ¥ Minikube çŠ¶æ€

```bash
minikube status
```

å¦‚æœæœªè¿è¡Œï¼Œæ‰§è¡Œï¼š

```bash
# ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿå®‰è£…è„šæœ¬
./scripts/install-k8s-cn.sh
```

#### éªŒè¯é›†ç¾¤

```bash
kubectl cluster-info
kubectl get nodes
```

---

### æ­¥éª¤ 2ï¼šæ„å»º Docker é•œåƒ

#### é…ç½® Docker ç¯å¢ƒ

```bash
# é‡è¦ï¼šä½¿ç”¨ Minikube çš„ Docker å®ˆæŠ¤è¿›ç¨‹
eval $(minikube docker-env)

# éªŒè¯
docker info | grep -i name
# åº”è¯¥æ˜¾ç¤ºï¼šName: minikube
```

#### æ„å»ºé•œåƒ

```bash
# æ„å»ºåç«¯é•œåƒï¼ˆå·²é…ç½®é˜¿é‡Œäº‘é•œåƒæºï¼‰
cd /root/learn/01-k8s/backend
docker build -t login-backend:latest .

# æ„å»ºå‰ç«¯é•œåƒï¼ˆå·²é…ç½®æ·˜å® npm é•œåƒæºï¼‰
cd /root/learn/01-k8s/frontend
docker build -t login-frontend:latest .
```

#### éªŒè¯é•œåƒ

```bash
eval $(minikube docker-env)
docker images | grep login
```

åº”è¯¥çœ‹åˆ°ï¼š
```
login-backend    latest    116MB
login-frontend   latest    53MB
```

---

### æ­¥éª¤ 3ï¼šåˆ›å»ºæŒä¹…åŒ–å­˜å‚¨

```bash
# åœ¨ Minikube èŠ‚ç‚¹ä¸­åˆ›å»ºç›®å½•
minikube ssh "sudo mkdir -p /mnt/data/postgres && sudo chmod 777 /mnt/data/postgres"

# éªŒè¯
minikube ssh "ls -ld /mnt/data/postgres"
```

---

### æ­¥éª¤ 4ï¼šéƒ¨ç½²åˆ° Kubernetes

#### ä½¿ç”¨è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd /root/learn/01-k8s
./scripts/deploy.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. åˆ›å»ºå‘½åç©ºé—´ `login-system`
2. éƒ¨ç½² PostgreSQLï¼ˆSecretã€ConfigMapã€PVã€PVCã€Deploymentã€Serviceï¼‰
3. éƒ¨ç½² Backendï¼ˆSecretã€ConfigMapã€Deploymentã€Serviceï¼‰
4. éƒ¨ç½² Frontendï¼ˆConfigMapã€Deploymentã€Serviceï¼‰
5. ï¼ˆå¯é€‰ï¼‰éƒ¨ç½² Ingress
6. æ˜¾ç¤ºè®¿é—®ä¿¡æ¯

#### æ‰‹åŠ¨é€æ­¥éƒ¨ç½²

```bash
cd /root/learn/01-k8s

# 1. åˆ›å»ºå‘½åç©ºé—´
kubectl apply -f k8s/namespace.yaml

# 2. éƒ¨ç½² PostgreSQL
kubectl apply -f k8s/postgres/
kubectl wait --for=condition=ready pod -l app=postgres -n login-system --timeout=120s

# 3. éƒ¨ç½²åç«¯
kubectl apply -f k8s/backend/
kubectl wait --for=condition=ready pod -l app=backend -n login-system --timeout=120s

# 4. éƒ¨ç½²å‰ç«¯
kubectl apply -f k8s/frontend/
kubectl wait --for=condition=ready pod -l app=frontend -n login-system --timeout=120s

# 5. (å¯é€‰) éƒ¨ç½² Ingress
kubectl apply -f k8s/ingress.yaml
```

---

### æ­¥éª¤ 5ï¼šéªŒè¯éƒ¨ç½²

```bash
# æŸ¥çœ‹æ‰€æœ‰èµ„æº
kubectl get all -n login-system

# æŸ¥çœ‹ Pod çŠ¶æ€
kubectl get pods -n login-system
```

âœ… æ‰€æœ‰ Pod çš„ STATUS éƒ½åº”è¯¥æ˜¯ `Running`ï¼ŒREADY åº”è¯¥æ˜¯ `1/1`ã€‚

---

## ğŸŒ è®¿é—®é…ç½®

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | ç®€å•åº¦ | ç¨³å®šæ€§ | åŸŸåæ”¯æŒ |
|------|---------|--------|--------|---------|
| **Port Forward (8080)** | å¿«é€Ÿæµ‹è¯• | â­â­â­â­â­ | â­â­â­â­ | âŒ |
| **NodePort** | ç¨³å®šä½¿ç”¨ | â­â­â­â­â­ | â­â­â­â­â­ | âŒ |
| **Ingress (WSL2å†…éƒ¨)** | WSL2å†…åŸŸåè®¿é—® | â­â­â­ | â­â­â­â­ | âœ… |
| **Port Forward + Windows hosts** | WindowsåŸŸåè®¿é—® | â­â­â­ | â­â­â­ | âœ… |

---

### æ–¹æ¡ˆ 1ï¼šPort Forwardï¼ˆæœ€ç®€å•ï¼‰â­æ¨è

é€‚ç”¨äºå¿«é€Ÿæµ‹è¯•å’Œå¼€å‘ã€‚

#### WSL2 ä¸­è®¿é—®

```bash
# è½¬å‘åˆ°æœ¬åœ° 8080 ç«¯å£
kubectl port-forward -n login-system service/frontend-service 8080:80
```

æµè§ˆå™¨è®¿é—®ï¼š**http://localhost:8080**

#### Windows ä¸­è®¿é—®

```bash
# åœ¨ WSL2 ä¸­æ‰§è¡Œï¼ˆç›‘å¬æ‰€æœ‰ç½‘å¡ï¼‰
kubectl port-forward -n login-system service/frontend-service 8080:80 --address 0.0.0.0 &

# è·å– WSL2 IP
WSL_IP=$(hostname -I | awk '{print $1}')
echo "Windows è®¿é—®: http://$WSL_IP:8080"
```

åœ¨ Windows æµè§ˆå™¨ä¸­è®¿é—®ï¼š**http://172.19.166.119:8080**

**æˆ–ä½¿ç”¨è‡ªåŠ¨é…ç½®è„šæœ¬ï¼š**

```bash
cd /root/learn/01-k8s
./scripts/setup-windows-access.sh
# é€‰æ‹©æ–¹å¼ 2
```

---

### æ–¹æ¡ˆ 2ï¼šNodePortï¼ˆæœ€ç¨³å®šï¼‰â­æ¨è

é€‚ç”¨äºç¨³å®šä½¿ç”¨ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

#### æŸ¥çœ‹ NodePort

```bash
kubectl get svc frontend-service -n login-system
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
NAME               TYPE       CLUSTER-IP     PORT(S)        AGE
frontend-service   NodePort   10.107.45.36   80:30080/TCP   1h
```

#### è®¿é—®åœ°å€

```bash
# ä½¿ç”¨ Minikube IPï¼ˆæ¨èï¼‰
MINIKUBE_IP=$(minikube ip)
echo "è®¿é—®: http://$MINIKUBE_IP:30080"
# http://192.168.49.2:30080

# æˆ–ä½¿ç”¨ WSL2 IP
WSL_IP=$(hostname -I | awk '{print $1}')
echo "è®¿é—®: http://$WSL_IP:30080"
# http://172.19.166.119:30080
```

**Windows æµè§ˆå™¨è®¿é—®**ï¼š
- `http://192.168.49.2:30080`
- `http://172.19.166.119:30080`

---

### æ–¹æ¡ˆ 3ï¼šIngress + åŸŸåï¼ˆWSL2 å†…éƒ¨ï¼‰

é€‚ç”¨äº WSL2 å†…éƒ¨ä½¿ç”¨åŸŸåè®¿é—®ã€‚

#### å¯ç”¨ Ingress

```bash
# 1. æ£€æŸ¥ Ingress Controller
kubectl get pods -n ingress-nginx

# 2. éƒ¨ç½² Ingress
kubectl apply -f k8s/ingress.yaml

# 3. å¯åŠ¨ Minikube Tunnel
nohup minikube tunnel > /tmp/minikube-tunnel.log 2>&1 &

# 4. é…ç½® hosts
sudo bash -c 'echo "127.0.0.1  login.local www.login.local api.login.local" >> /etc/hosts'

# 5. æµ‹è¯•è®¿é—®
curl http://login.local/api/health/
```

#### è®¿é—®åœ°å€

- å‰ç«¯ä¸»ç«™ï¼š`http://login.local`
- æ³¨å†Œé¡µé¢ï¼š`http://login.local/register`
- ç™»å½•é¡µé¢ï¼š`http://login.local/login`
- API æ¥å£ï¼š`http://api.login.local/api/health/`

---

### æ–¹æ¡ˆ 4ï¼šPort Forward + Windows hosts

é€‚ç”¨äº Windows ä¸­ä½¿ç”¨åŸŸåè®¿é—®ã€‚

#### WSL2 é…ç½®

```bash
# 1. å¯åŠ¨ port-forwardï¼ˆç›‘å¬æ‰€æœ‰ç½‘å¡ï¼‰
kubectl port-forward -n login-system service/frontend-service 8080:80 --address 0.0.0.0 &

# 2. è·å– WSL2 IP
hostname -I | awk '{print $1}'
# ä¾‹å¦‚ï¼š172.19.166.119
```

#### Windows é…ç½®

**æ­¥éª¤ 1ï¼šä¿®æ”¹ Windows hosts æ–‡ä»¶**

1. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œè®°äº‹æœ¬
2. æ‰“å¼€æ–‡ä»¶ï¼š`C:\Windows\System32\drivers\etc\hosts`
3. åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š

```
# K8s Login System (WSL2)
172.19.166.119  login.local www.login.local api.login.local
```

4. ä¿å­˜æ–‡ä»¶

**æ­¥éª¤ 2ï¼šæ¸…é™¤ DNS ç¼“å­˜**

åœ¨ PowerShellï¼ˆç®¡ç†å‘˜ï¼‰ä¸­æ‰§è¡Œï¼š

```powershell
ipconfig /flushdns
```

**æ­¥éª¤ 3ï¼šè®¿é—®**

Windows æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š**http://login.local:8080**

---

### å¿«é€Ÿé…ç½®è„šæœ¬

ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ç®€åŒ–é…ç½®ï¼š

```bash
cd /root/learn/01-k8s
./scripts/setup-windows-access.sh
```

é€‰é¡¹ï¼š
1. **NodePort æ–¹å¼**ï¼ˆæœ€ç¨³å®šï¼‰- æ— éœ€é¢å¤–é…ç½®
2. **Port-forward åˆ° 8080**ï¼ˆæœ€ç®€å•ï¼‰- é€‚åˆå¿«é€Ÿæµ‹è¯•
3. **Port-forward + åŸŸå**ï¼ˆé«˜çº§ï¼‰- éœ€è¦ä¿®æ”¹ Windows hosts

---

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### 1. å¥åº·æ£€æŸ¥

```bash
# åç«¯ API
curl http://localhost:8080/api/health/
# é¢„æœŸï¼š{"status":"healthy","service":"authentication-api","version":"1.0.0"}
```

### 2. ç”¨æˆ·æ³¨å†Œ

**æµè§ˆå™¨æµ‹è¯•ï¼š**
1. è®¿é—® http://localhost:8080/register
2. å¡«å†™æ³¨å†Œä¿¡æ¯
3. ç‚¹å‡»"æ³¨å†Œ"æŒ‰é’®
4. âœ… åº”æ˜¾ç¤º"æ³¨å†ŒæˆåŠŸï¼3ç§’åè·³è½¬åˆ°ç™»å½•é¡µé¢..."

**å‘½ä»¤è¡Œæµ‹è¯•ï¼š**

```bash
curl -X POST http://localhost:8080/api/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "test123456",
    "password2": "test123456"
  }'
```

### 3. ç”¨æˆ·ç™»å½•

**æµè§ˆå™¨æµ‹è¯•ï¼š**
1. è®¿é—® http://localhost:8080/login
2. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
3. ç‚¹å‡»"ç™»å½•"
4. âœ… åº”è·³è½¬åˆ°é¦–é¡µå¹¶æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯

**å‘½ä»¤è¡Œæµ‹è¯•ï¼š**

```bash
curl -X POST http://localhost:8080/api/token/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "test123456"
  }'
```

### 4. éªŒè¯æ•°æ®åº“

```bash
# è¿›å…¥ PostgreSQL å®¹å™¨
kubectl exec -it -n login-system deployment/postgres-deployment -- psql -U postgres -d logindb

# æŸ¥çœ‹ç”¨æˆ·è¡¨
\dt
SELECT * FROM users;

# é€€å‡º
\q
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: Pod ä¸€ç›´å¤„äº Pending çŠ¶æ€

**åŸå› ï¼š** PV æ— æ³•ç»‘å®šæˆ–èµ„æºä¸è¶³

**è§£å†³ï¼š**

```bash
# æ£€æŸ¥ PV/PVC çŠ¶æ€
kubectl get pv,pvc -n login-system

# ç¡®ä¿å­˜å‚¨ç›®å½•å­˜åœ¨
minikube ssh "sudo ls -ld /mnt/data/postgres"

# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name> -n login-system
```

### Q2: åç«¯ Pod å¯åŠ¨å¤±è´¥

**åŸå› ï¼š** æ•°æ®åº“æœªå°±ç»ªæˆ–è¿æ¥å¤±è´¥

**è§£å†³ï¼š**

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
kubectl logs -n login-system deployment/backend-deployment

# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œ
kubectl get pods -n login-system -l app=postgres

# æµ‹è¯•æ•°æ®åº“è¿æ¥
kubectl exec -it -n login-system deployment/backend-deployment -- sh
nc -zv postgres-service 5432
```

### Q3: é•œåƒæ‹‰å–å¤±è´¥ (ImagePullBackOff)

**åŸå› ï¼š** é•œåƒä¸åœ¨ Minikube çš„ Docker ä¸­

**è§£å†³ï¼š**

```bash
# ç¡®ä¿ä½¿ç”¨ Minikube çš„ Docker
eval $(minikube docker-env)

# é‡æ–°æ„å»ºé•œåƒ
docker build -t login-backend:latest ./backend
docker build -t login-frontend:latest ./frontend

# éªŒè¯é•œåƒå­˜åœ¨
docker images | grep login

# é‡å¯ Pod
kubectl rollout restart deployment/backend-deployment -n login-system
kubectl rollout restart deployment/frontend-deployment -n login-system
```

### Q4: Windows æ— æ³•è®¿é—®

**åŸå› ï¼š** WSL2 ç½‘ç»œéš”ç¦»æˆ–é˜²ç«å¢™é˜»æ­¢

**è§£å†³ï¼š**

```bash
# 1. æ£€æŸ¥ port-forward æ˜¯å¦è¿è¡Œ
ps aux | grep port-forward

# 2. é‡æ–°å¯åŠ¨ port-forwardï¼ˆç›‘å¬æ‰€æœ‰ç½‘å¡ï¼‰
kubectl port-forward -n login-system service/frontend-service 8080:80 --address 0.0.0.0 &

# 3. è·å– WSL2 IP
hostname -I

# 4. Windows ä¸­æµ‹è¯•
# PowerShell: Test-NetConnection 172.19.166.119 -Port 8080
```

**Windows é˜²ç«å¢™è®¾ç½®ï¼š**

```powershell
# PowerShellï¼ˆç®¡ç†å‘˜ï¼‰
New-NetFirewallRule -DisplayName "WSL2 K8s" -Direction Inbound -LocalPort 8080,30080 -Protocol TCP -Action Allow
```

### Q5: åŸŸåæ— æ³•è®¿é—®

**WSL2 å†…éƒ¨ï¼ˆIngressï¼‰ï¼š**

```bash
# 1. æ£€æŸ¥ tunnel æ˜¯å¦è¿è¡Œ
ps aux | grep "minikube tunnel"

# 2. é‡å¯ tunnel
pkill -f "minikube tunnel"
nohup minikube tunnel > /tmp/minikube-tunnel.log 2>&1 &

# 3. æ£€æŸ¥ hosts æ–‡ä»¶
cat /etc/hosts | grep login.local

# 4. æµ‹è¯•è®¿é—®
curl http://login.local/api/health/
```

**Windowsï¼ˆPort Forward + hostsï¼‰ï¼š**

```powershell
# 1. æ£€æŸ¥ hosts æ–‡ä»¶
type C:\Windows\System32\drivers\etc\hosts | findstr login.local

# 2. æ¸…é™¤ DNS ç¼“å­˜
ipconfig /flushdns

# 3. æµ‹è¯•åŸŸåè§£æ
ping login.local

# 4. æµ‹è¯•è®¿é—®
curl http://login.local:8080/api/health/
```

### Q6: WSL2 IP å˜åŒ–å¯¼è‡´æ— æ³•è®¿é—®

**åŸå› ï¼š** WSL2 é‡å¯å IP å¯èƒ½å˜åŒ–

**è§£å†³ï¼š**

```bash
# 1. è·å–æ–°çš„ WSL2 IP
hostname -I | awk '{print $1}'

# 2. æ›´æ–° Windows hosts æ–‡ä»¶
# å°† 172.19.166.119 æ›¿æ¢ä¸ºæ–°çš„ IP

# 3. æ¸…é™¤ Windows DNS ç¼“å­˜
# PowerShell: ipconfig /flushdns
```

**æ¨èï¼šä½¿ç”¨ Minikube IPï¼ˆæ›´ç¨³å®šï¼‰**

```bash
minikube ip
# 192.168.49.2
```

---

## ğŸ› ï¸ ç®¡ç†ç»´æŠ¤

### æŸ¥çœ‹çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰èµ„æº
kubectl get all -n login-system

# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name> -n login-system

# æŸ¥çœ‹æ—¥å¿—
kubectl logs -f deployment/backend-deployment -n login-system
kubectl logs -f deployment/frontend-deployment -n login-system
kubectl logs -f deployment/postgres-deployment -n login-system

# æŸ¥çœ‹äº‹ä»¶
kubectl get events -n login-system --sort-by='.lastTimestamp'
```

### æ‰©ç¼©å®¹

```bash
# æ‰©å±•åç«¯åˆ° 5 ä¸ªå‰¯æœ¬
kubectl scale deployment backend-deployment --replicas=5 -n login-system

# æ‰©å±•å‰ç«¯åˆ° 3 ä¸ªå‰¯æœ¬
kubectl scale deployment frontend-deployment --replicas=3 -n login-system

# æŸ¥çœ‹æ‰©å®¹çŠ¶æ€
kubectl get pods -n login-system -w
```

### æ›´æ–°éƒ¨ç½²

```bash
# é‡æ–°æ„å»ºé•œåƒ
eval $(minikube docker-env)
docker build -t login-backend:v2 ./backend

# æ›´æ–°é•œåƒï¼ˆæ»šåŠ¨æ›´æ–°ï¼‰
kubectl set image deployment/backend-deployment \
  backend=login-backend:v2 -n login-system

# æŸ¥çœ‹æ»šåŠ¨æ›´æ–°çŠ¶æ€
kubectl rollout status deployment/backend-deployment -n login-system

# å›æ»š
kubectl rollout undo deployment/backend-deployment -n login-system
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯åç«¯
kubectl rollout restart deployment/backend-deployment -n login-system

# é‡å¯å‰ç«¯
kubectl rollout restart deployment/frontend-deployment -n login-system

# é‡å¯æ•°æ®åº“ï¼ˆè°¨æ…æ“ä½œï¼‰
kubectl rollout restart deployment/postgres-deployment -n login-system
```

### è¿›å…¥å®¹å™¨

```bash
# è¿›å…¥åç«¯å®¹å™¨
kubectl exec -it -n login-system deployment/backend-deployment -- sh

# è¿›å…¥å‰ç«¯å®¹å™¨
kubectl exec -it -n login-system deployment/frontend-deployment -- sh

# è¿›å…¥æ•°æ®åº“å®¹å™¨
kubectl exec -it -n login-system deployment/postgres-deployment -- sh
```

### æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
kubectl exec -n login-system deployment/postgres-deployment -- \
  pg_dump -U postgres logindb > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
cat backup_20251127.sql | kubectl exec -i -n login-system deployment/postgres-deployment -- \
  psql -U postgres -d logindb
```

### æ¸…ç†èµ„æº

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨æ¸…ç†è„šæœ¬
cd /root/learn/01-k8s
./scripts/cleanup.sh

# æ–¹æ³• 2ï¼šæ‰‹åŠ¨åˆ é™¤
kubectl delete namespace login-system
kubectl delete pv postgres-pv

# æ¸…ç† Minikube ä¸­çš„æ•°æ®
minikube ssh "sudo rm -rf /mnt/data/postgres"

# æ¸…ç† hosts æ–‡ä»¶ï¼ˆå¦‚æœé…ç½®äº†åŸŸåï¼‰
sudo sed -i '/# K8s Login System/,+1d' /etc/hosts
```

---

## ğŸ“Š èµ„æºé…ç½®è¯´æ˜

### éƒ¨ç½²èµ„æºæ¸…å•

| èµ„æºç±»å‹ | åç§° | å‰¯æœ¬æ•° | å†…å­˜è¯·æ±‚ | CPUè¯·æ±‚ | è¯´æ˜ |
|---------|------|--------|----------|---------|------|
| **PostgreSQL** | postgres-deployment | 1 | 256Mi | 250m | æ•°æ®åº“+PV(10Gi) |
| **Backend** | backend-deployment | 3 | 256Mi | 250m | Django+DRF |
| **Frontend** | frontend-deployment | 2 | 64Mi | 100m | Vue3+Nginx |

### æŒä¹…åŒ–å­˜å‚¨

- **PV**: 10Gi (hostPath: /mnt/data/postgres)
- **PVC**: 5Gi (ä½¿ç”¨ manual StorageClass)
- **ä¿ç•™ç­–ç•¥**: Retainï¼ˆåˆ é™¤ PVC å PV ä»ä¿ç•™æ•°æ®ï¼‰

### ç½‘ç»œé…ç½®

| æœåŠ¡ | ç±»å‹ | é›†ç¾¤IP | ç«¯å£ | NodePort | è¯´æ˜ |
|------|------|--------|------|----------|------|
| postgres-service | ClusterIP | è‡ªåŠ¨åˆ†é… | 5432 | - | ä»…å†…éƒ¨è®¿é—® |
| backend-service | ClusterIP | è‡ªåŠ¨åˆ†é… | 8000 | - | ä»…å†…éƒ¨è®¿é—® |
| frontend-service | NodePort | è‡ªåŠ¨åˆ†é… | 80 | 30080 | å¤–éƒ¨å¯è®¿é—® |

---

## ğŸ” å®‰å…¨è¯´æ˜

### é»˜è®¤å¯†ç ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼ï¼‰

```bash
# PostgreSQL å¯†ç 
ç”¨æˆ·å: postgres
å¯†ç : postgres123 (base64: cG9zdGdyZXMxMjM=)

# Django Secret Key
django-secret-key-change-in-production-environment
```

### ä¿®æ”¹å¯†ç 

```bash
# 1. ç”Ÿæˆæ–°å¯†ç 
NEW_PASSWORD=$(openssl rand -base64 32)
echo -n "$NEW_PASSWORD" | base64

# 2. ç¼–è¾‘ Secret
kubectl edit secret postgres-secret -n login-system
kubectl edit secret backend-secret -n login-system

# 3. é‡å¯æœåŠ¡
kubectl rollout restart deployment/postgres-deployment -n login-system
kubectl rollout restart deployment/backend-deployment -n login-system
```

---

## ğŸ“š ç›¸å…³èµ„æº

### å®˜æ–¹æ–‡æ¡£

- [Kubernetes å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/)
- [Vue.js å®˜æ–¹æ–‡æ¡£](https://cn.vuejs.org/)
- [Django å®˜æ–¹æ–‡æ¡£](https://www.djangoproject.com/)
- [PostgreSQL å®˜æ–¹æ–‡æ¡£](https://www.postgresql.org/)

### é¡¹ç›®è„šæœ¬

- `scripts/install-k8s-cn.sh` - K8s å®‰è£…è„šæœ¬ï¼ˆå›½å†…é•œåƒï¼‰
- `scripts/deploy.sh` - ä¸€é”®éƒ¨ç½²è„šæœ¬
- `scripts/cleanup.sh` - æ¸…ç†è„šæœ¬
- `scripts/setup-windows-access.sh` - Windows è®¿é—®é…ç½®è„šæœ¬

---

## ğŸ’¡ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ

1. ä½¿ç”¨ **Port Forward** æ–¹å¼å¿«é€Ÿè®¿é—®
2. å•å‰¯æœ¬éƒ¨ç½²èŠ‚çœèµ„æº
3. å¯ç”¨çƒ­æ›´æ–°åŠ å¿«å¼€å‘

### æµ‹è¯•ç¯å¢ƒ

1. ä½¿ç”¨ **NodePort** æ–¹å¼ç¨³å®šè®¿é—®
2. å¤šå‰¯æœ¬æµ‹è¯•é«˜å¯ç”¨
3. é…ç½®åŸŸåæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒ

### ç”Ÿäº§ç¯å¢ƒ

1. ä½¿ç”¨ **Ingress + TLS** æä¾› HTTPS
2. é…ç½®èµ„æºé™åˆ¶å’Œ HPA
3. ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“ï¼ˆå¦‚ RDSï¼‰
4. é…ç½®ç›‘æ§å’Œæ—¥å¿—æ”¶é›†
5. å®šæœŸå¤‡ä»½æ•°æ®

---

## ğŸ‰ æ€»ç»“

æ‚¨ç°åœ¨å·²ç»æŒæ¡äº†ï¼š

âœ… **åŸºç¡€éƒ¨ç½²**ï¼šä¸€é”®éƒ¨ç½²åˆ° K8s é›†ç¾¤  
âœ… **è®¿é—®é…ç½®**ï¼š4ç§è®¿é—®æ–¹å¼æ»¡è¶³ä¸åŒåœºæ™¯  
âœ… **åŸŸåé…ç½®**ï¼šWSL2 å’Œ Windows åŸŸåè®¿é—®  
âœ… **é—®é¢˜æ’æŸ¥**ï¼šå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ  
âœ… **æ—¥å¸¸ç»´æŠ¤**ï¼šæ‰©ç¼©å®¹ã€æ›´æ–°ã€å¤‡ä»½ç­‰æ“ä½œ  

**ä¸‹ä¸€æ­¥ï¼š**

1. é…ç½® Prometheus + Grafana ç›‘æ§
2. å®ç° CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²
3. æ·»åŠ æ›´å¤šä¸šåŠ¡åŠŸèƒ½
4. è¿›è¡Œå‹åŠ›æµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–

---

**ğŸŠ æ­å–œï¼æ‚¨å·²æˆåŠŸæŒæ¡ K8s ç™»å½•ç³»ç»Ÿçš„å®Œæ•´éƒ¨ç½²ï¼**

**Happy Coding!** ğŸ’»

